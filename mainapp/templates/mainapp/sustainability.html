{% extends 'mainapp/navbar_footer.html' %}
{% load static %}

{% block title %}Sustainability - Ecopath{% endblock %}

{% block extra_head %}
<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<!-- <script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'custom-green': '#17411A',
                    'custom-yellow': '#F0ED2F',
                    'card-bg-green': '#CAEACC',
                    'card-bg-dark-green': '#7DCC83'
                },
                fontFamily: {
                    'montserrat': ['Montserrat', 'sans-serif'],
                    'product-sans': ['Product Sans', 'sans-serif'],
                    'playfair-display': ['Playfair Display', 'serif']
                }
            }
        }
    }
</script> -->
{% endblock %}

{% block content %}
<section class="relative h-screen w-full bg-cover bg-center text-white py-24 lg:p-12 lg:px-12 lg:pt-24"
    style="background-image: url('{% static 'images/Sustainability Hero Header.webp' %}');">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative h-full flex flex-col justify-center md:justify-center p-12 px-8">
        <h1 class="text-4xl lg:text-5xl xl:text-6xl 2xl:text-7xl font-product-sans font-black uppercase mb-10">
            SUSTAINABILITY
        </h1>
        <p class="text-4xl md:text-6xl font-playfair-display max-w-4xl leading-tight">
            Weâ€™re rebuilding the world without cement. Because the future of infrastructure shouldnâ€™t come at the cost
            of the planet.
        </p>
    </div>
</section>

<section class="py-8 px-4 sm:px-6 lg:px-8">
    <div class="container mx-auto">
        <div class="flex flex-col md:flex-row lg:mx-12 gap-8">
            <!-- Text Column -->
            <div class="w-full md:w-1/2 py-6 items-end">
                <h2 class="text-3xl md:text-4xl lg:text-5xl font-product-sans font-black text-custom-green py-8">
                    Building the Future Responsibly
                </h2>
                <p class="font-montserrat text-lg text-gray-700 leading-relaxed">
                    At Ecopath, weâ€™re transforming infrastructure with materials that cut carbon, reuse waste, and
                    protect the planetâ€™s future.
                    <br><br>
                    Ecopathâ€™s mission is to redefine how roads and infrastructure are built â€” by replacing
                    high-emission
                    materials with sustainable, circular alternatives. Sustainability sits at the heart of our
                    innovation, shaping every design, product, and process we create.
                    <br><br>
                    Our goal is simple: engineering progress that doesnâ€™t come at the planetâ€™s expense.
                </p>
            </div>

            <!-- Image Column -->
            <div class="w-full md:w-1/2 flex justify-center">
                <img src="{% static 'images/Ecopath_PrecaseConcreteRoads.webp' %}" alt="Precast Concrete Roads"
                    class="w-full max-w-[450px] h-[600px] object-cover rounded-tl-[50px] rounded-br-[50px]">
            </div>
        </div>
    </div>
</section>

<!-- Impacts Section -->
<section class="py-10 px-4 sm:px-6 lg:px-8">
    <div class="container mx-auto">
        <h2 class="text-3xl md:text-4xl lg:text-5xl font-product-sans font-black py-8 text-custom-green">
            Measurable Progress. Real Impact.
        </h2>

        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
            <!-- Service Card 1 -->
            <div
                class="bg-card-bg-green rounded-xl p-8 py-24 lg:py-36 shadow-md flex flex-col items-center justify-center text-center">
                <h3 class="text-3xl md:text-4xl font-product-sans font-black py-6">75 - 80%</h3>
                <p class="font-montserrat text-lg md:text-xl">
                    less CO2 emissions than traditional concrete.
                </p>
            </div>

            <!-- Service Card 2 -->
            <div
                class="bg-card-bg-green rounded-xl p-8 py-24 lg:py-36 shadow-md flex flex-col items-center justify-center text-center">
                <h3 class="text-3xl md:text-4xl font-product-sans font-black mb-4">30%</h3>
                <p class="font-montserrat text-lg md:text-xl ">
                    water saved during production.
                </p>
            </div>

            <!-- Service Card 3 -->
            <div
                class="bg-card-bg-green rounded-xl p-2 py-24 lg:py-36 shadow-md flex flex-col items-center justify-center text-center">
                <h3 class="text-3xl md:text-4xl font-product-sans font-black mb-4">10,000+ tonnes</h3>
                <p class="font-montserrat text-lg md:text-xl ">
                    of industrial waste reused.
                </p>
            </div>

            <!-- Service Card 4 -->
            <div
                class="bg-card-bg-green rounded-xl p-8 py-24 lg:py-36 shadow-md flex flex-col items-center justify-center text-center">
                <h3 class="text-3xl md:text-4xl font-product-sans font-black mb-4">2x</h3>
                <p class="font-montserrat text-lg md:text-xl ">
                    road lifespan compared to cement-based ones.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Sustainability in Action Section with Carousel -->
<section class="pt-8 pb-24 px-4 sm:px-6 lg:px-8 lg:pr-0">
    <div class="mx-auto flex flex-col md:flex-row gap-5 md:gap-16 items-center">

        <!-- Text Column -->
        <div class="w-full md:w-6/12 lg:w-5/12 md:mt-24 md:mx-12">

            <h2 class="text-3xl md:text-4xl lg:text-5xl font-product-sans font-black py-8 text-custom-green">
                Sustainability in Action
            </h2>
            <p class="font-montserrat text-lg text-gray-700 leading-relaxed">
                Behind every Ecopath road is a cleaner, smarter process â€” from collecting industrial by-products
                to reusing aggregates and cutting emissions on-site.
            </p>
        </div>

        <!-- Carousel Column -->
        <div class="w-full md:w-6/12 lg:w-7/12">
            <div class="flex justify-end mb-4 me-12">
                <div class="flex items-center gap-8">
                    <button id="sustainability-prev"
                        class="text-4xl md:text-6xl text-black text-custom-green transition-colors">
                        &#8249;
                    </button>
                    <button id="sustainability-next"
                        class="text-4xl md:text-6xl text-black text-custom-green transition-colors">
                        &#8250;
                    </button>
                </div>
            </div>
            <div class="relative overflow-hidden rounded-lg" id="sustainability-carousel">
                <div class="flex space-x-4" id="sustainability-track">
                    <div class="basis-[80%] flex-shrink-0 carousel-slide relative">
                        <img src="{% static 'images/Sustainability images 1.webp' %}" alt="Sustainability slide 1"
                            class="w-full h-full object-cover rounded-lg">
                        <div class="absolute inset-0 bg-black/40 rounded-lg opacity-0 pointer-events-none peek-overlay">
                        </div>
                    </div>
                    <div class="basis-[80%] flex-shrink-0 carousel-slide relative">
                        <img src="{% static 'images/Sustainability images 2.webp' %}" alt="Sustainability slide 2"
                            class="w-full h-full object-cover rounded-lg">
                        <div class="absolute inset-0 bg-black/40 rounded-lg opacity-0 pointer-events-none peek-overlay">
                        </div>
                    </div>
                    <div class="basis-[80%] flex-shrink-0 carousel-slide relative">
                        <img src="{% static 'images/Sustainability images 3.webp' %}" alt="Sustainability slide 3"
                            class="w-full h-full object-cover rounded-lg">
                        <div class="absolute inset-0 bg-black/40 rounded-lg opacity-0 pointer-events-none peek-overlay">
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const slides = document.querySelectorAll('#sustainability-carousel .carousel-slide');
        const overlays = document.querySelectorAll('#sustainability-carousel .peek-overlay');
        const track = document.getElementById('sustainability-track');
        const carousel = document.getElementById('sustainability-carousel');
        const prevBtn = document.getElementById('sustainability-prev');
        const nextBtn = document.getElementById('sustainability-next');
        if (!slides.length || !track || !carousel || !prevBtn || !nextBtn) return;

        let currentIndex = 0;
        const disabledClasses = ['text-gray-400', 'opacity-40', 'cursor-not-allowed'];

        const getStep = () => {
            const gap = 16; // matches space-x-4 (1rem ~ 16px)
            return carousel.clientWidth * 0.8 + gap;
        };

        const updateArrows = () => {
            if (currentIndex === 0) {
                prevBtn.classList.add(...disabledClasses);
                prevBtn.style.pointerEvents = 'none';

            } else {
                prevBtn.classList.remove(...disabledClasses);
                prevBtn.style.pointerEvents = '';
            }

            if (currentIndex === slides.length - 1) {
                nextBtn.classList.add(...disabledClasses);
                nextBtn.style.pointerEvents = 'none';
            } else {
                nextBtn.classList.remove(...disabledClasses);
                nextBtn.style.pointerEvents = '';
            }
        };

        const updatePeekOverlay = () => {
            // Determine which slide should show the "peek" overlay.
            // By default, it's the next slide (currentIndex + 1). When on the last slide,
            // show the previous slide instead so the left-side peek is visible.
            const peekIndex = (currentIndex < slides.length - 1) ? (currentIndex + 1) : Math.max(0, currentIndex - 1);
            overlays.forEach((overlay, i) => {
                const isPeek = i === peekIndex;
                gsap.to(overlay, {
                    opacity: isPeek ? 1 : 0,
                    duration: 0.3,
                    ease: 'power2.out'
                });
            });
        };

        const goToSlide = (index) => {
            const clampedIndex = Math.max(0, Math.min(index, slides.length - 1));
            if (clampedIndex === currentIndex) return;
            currentIndex = clampedIndex;
            const step = getStep();
            // If we're on the last slide, shift the track so the PREVIOUS slide
            // shows a 20% peek on the left side of the carousel. Otherwise, position
            // slides normally (each slide starts at the container left edge).
            if (clampedIndex === slides.length - 1 && slides.length > 1) {
                const peekWidth = carousel.clientWidth * 0.2; // 20% peek
                const slideWidth = carousel.clientWidth * 0.8;
                // Position so the PREVIOUS slide's right edge sits at `peekWidth` from the left.
                const prevIndex = clampedIndex - 1;
                const targetX = peekWidth - slideWidth - (prevIndex * step);
                gsap.to(track, {
                    x: targetX,
                    duration: 0.6,
                    ease: 'power3.inOut'
                });
            } else {
                gsap.to(track, {
                    x: -step * currentIndex,
                    duration: 0.6,
                    ease: 'power3.inOut'
                });
            }
            updateArrows();
            updatePeekOverlay();
        };

        // initial state
        updateArrows();
        updatePeekOverlay();

        prevBtn.addEventListener('click', () => {
            goToSlide(currentIndex - 1);
        });
        nextBtn.addEventListener('click', () => {
            goToSlide(currentIndex + 1);
        });
    });
</script>

<section class="py-24 md:py-32 px-4 sm:px-6 lg:px-8 bg-[#E6E6DF]">
    <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-center md:justify-center gap-8 md:gap-16">
            <!-- Content Column (Left on large screens) -->
            <div class="md:w-3/5">
                <h2 class="text-4xl font-product-sans font-semibold text-custom-green mb-12">
                    Our Commitment in Documents
                </h2>

                <!-- Navigation List -->
                <div class="flex justify-start">
                    <ul id="infra-nav" class="relative space-y-4 w-full max-w-xs">
                        <!-- Active Item Indicator Bar -->
                        <li id="active-bar"
                            class="absolute left-0 w-1 h-6 bg-custom-green transition-all duration-200 ease-in-out"
                            style="top: 0px;"></li>

                        <!-- List Items -->
                        <li class="nav-item text-xl font-semibold font-product-sans font-black pl-6 cursor-pointer transition-colors duration-200 hover:text-custom-green"
                            data-index="0">
                            Sustainability Reports
                        </li>
                        <li class="nav-item text-xl font-semibold font-semibold font-product-sans font-black pl-6 cursor-pointer transition-colors duration-200 hover:text-custom-green"
                            data-index="1">
                            Patents
                        </li>
                        <li class="nav-item text-xl font-semibold font-product-sans font-black pl-6 cursor-pointer transition-colors duration-200 hover:text-custom-green"
                            data-index="2">
                            Awards & Recognition
                        </li>
                    </ul>
                </div>

            </div>

            <!-- Documents Panel (Right on large screens) -->
            <div class="w-full md:w-2/5 flex items-start justify-center md:justify-end mt-8 md:mt-0">
                <div class="w-full max-w-md space-y-4" id="documents-panels">
                    <!-- Panel 0: Sustainability Reports -->
                    <div class="doc-panel" data-index="0">
                        <a href="#"
                            class="flex items-center gap-3 text-sm md:text-base font-montserrat text-gray-800 hover:text-custom-green">
                            <span class="text-red-600 text-lg">ðŸ“„</span>
                            <span>FY24 Ecopath Sustainability Data</span>
                        </a>
                        <a href="#"
                            class="mt-2 flex items-center gap-3 text-sm md:text-base font-montserrat text-gray-800 hover:text-custom-green">
                            <span class="text-red-600 text-lg">ðŸ“„</span>
                            <span>FY23 Ecopath Sustainability Data</span>
                        </a>
                    </div>

                    <!-- Panel 1: Patents -->
                    <div class="doc-panel" data-index="1">
                        <a href="#"
                            class="flex items-center gap-3 text-sm md:text-base font-montserrat text-gray-800 hover:text-custom-green">
                            <span class="text-red-600 text-lg">ðŸ“„</span>
                            <span>Ecopath Core Binder Patent Filing</span>
                        </a>
                        <a href="#"
                            class="mt-2 flex items-center gap-3 text-sm md:text-base font-montserrat text-gray-800 hover:text-custom-green">
                            <span class="text-red-600 text-lg">ðŸ“„</span>
                            <span>Precast Road Panel System Patent</span>
                        </a>
                    </div>

                    <!-- Panel 2: Awards & Recognition -->
                    <div class="doc-panel" data-index="2">
                        <a href="#"
                            class="flex items-center gap-3 text-sm md:text-base font-montserrat text-gray-800 hover:text-custom-green">
                            <span class="text-red-600 text-lg">ðŸ“„</span>
                            <span>National Green Infrastructure Award 2024</span>
                        </a>
                        <a href="#"
                            class="mt-2 flex items-center gap-3 text-sm md:text-base font-montserrat text-gray-800 hover:text-custom-green">
                            <span class="text-red-600 text-lg">ðŸ“„</span>
                            <span>Circular Economy Innovation Grant Report</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // Documents tab behavior
    document.addEventListener('DOMContentLoaded', () => {
        const navItems = gsap.utils.toArray('.nav-item');
        const panels = gsap.utils.toArray('.doc-panel');
        const activeBar = document.getElementById('active-bar');

        if (!navItems.length || !panels.length || !activeBar) return;

        let activeIndex = 0;

        const showPanel = (newIndex, animate = false) => {
            const currentPanel = panels[activeIndex];
            const nextPanel = panels[newIndex];

            if (!nextPanel) return;

            // Instantly hide all non-target panels to avoid overlap
            panels.forEach((panel, i) => {
                if (i !== newIndex) {
                    gsap.set(panel, { autoAlpha: 0, y: 10, display: 'none' });
                }
            });

            if (!animate) {
                gsap.set(nextPanel, { autoAlpha: 1, y: 0, display: 'block' });
                return;
            }

            // Optional small fade-out of current before showing next
            const tl = gsap.timeline();

            if (currentPanel && currentPanel !== nextPanel) {
                tl.to(currentPanel, {
                    autoAlpha: 0,
                    y: 10,
                    duration: 0.15,
                    ease: 'power2.in',
                    onComplete: () => gsap.set(currentPanel, { display: 'none' })
                });
            }

            tl.fromTo(nextPanel,
                { autoAlpha: 0, y: 10, display: 'block' },
                {
                    autoAlpha: 1,
                    y: 0,
                    duration: 0.25,
                    ease: 'power2.out'
                }
            );
        };

        const updateActiveState = (newIndex) => {
            if (newIndex === activeIndex) return;

            navItems[activeIndex].classList.remove('text-custom-green');
            navItems[newIndex].classList.add('text-custom-green');
            activeIndex = newIndex;

            const activeNavItem = navItems[activeIndex];
            gsap.set(activeBar, {
                top: activeNavItem.offsetTop,
                height: activeNavItem.offsetHeight
            });

            gsap.fromTo(activeBar,
                { scaleY: 0.8, opacity: 0.7 },
                {
                    scaleY: 1,
                    opacity: 1,
                    duration: 0.2,
                    ease: 'power2.out'
                }
            );

            showPanel(activeIndex, true);
        };

        // Initial state
        gsap.set(activeBar, {
            top: navItems[0].offsetTop,
            height: navItems[0].offsetHeight
        });
        navItems[0].classList.add('text-custom-green');
        panels.forEach((panel, i) => {
            gsap.set(panel, {
                autoAlpha: i === 0 ? 1 : 0,
                y: i === 0 ? 0 : 10,
                display: i === 0 ? 'block' : 'none'
            });
        });

        navItems.forEach((item, index) => {
            item.addEventListener('click', () => updateActiveState(index));
        });
    });
</script>

<!--Calculator-->
<section class="py-16 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <div class="rounded-lg shadow-lg px-6 sm:px-10 lg:px-14 py-10 sm:py-12 lg:py-14 flex flex-col gap-8 lg:gap-10"
            style="background-image: url('{% static 'images/About timeline background.webp' %}'); background-size: cover; background-position: center;">

            <div class="w-full gap-4">
                <h2 class="text-3xl md:text-4xl lg:text-5xl font-product-sans text-custom-green py-8">
                    Measure your Impact
                </h2>
                <p class="font-montserrat text-lg text-gray-700 max-w-3xl">
                    Compare EcoConcrete with traditional materials and see the carbon savings for your project with
                    our Carbon Calculator.
                </p>
            </div>

            <div class="w-full flex flex-col lg:flex-row gap-10 lg:gap-16">

                <div class="w-full lg:w-1/2">
                    <form id="impact-calculator-form" class="space-y-6" onsubmit="return false;">

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-montserrat text-gray-700 mb-2">Product <span
                                        class="text-red-500">*</span></label>
                                <div class="relative">
                                    <select id="calc-product" onchange="updateFormFields()"
                                        class="w-full border border-gray-300 rounded-lg py-2.5 px-3 pr-8 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green appearance-none bg-white">
                                        <option value="Solid Block">Solid Block</option>
                                        <option value="Paver">Paver</option>
                                        <option value="Kerbstone">Kerbstone</option>
                                        <option value="Saucer Drain">Saucer Drain</option>
                                        <option value="U Drain">U Drain</option>
                                        <option value="Precast Slab">Precast Slab</option>
                                        <option value="Boundary Wall Panel">Boundary Wall Panel</option>
                                        <option value="Precast Road">Precast Road</option>
                                    </select>
                                    <span
                                        class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500 text-xs md:text-sm">â–¾</span>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-montserrat text-gray-700 mb-2">Grade (Optional)</label>
                                <div class="relative">
                                    <select id="calc-grade"
                                        class="w-full border border-gray-300 rounded-lg py-2.5 px-3 pr-8 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green appearance-none bg-white">
                                        <option value="Default">Default</option>
                                        <option value="M7.5">M7.5</option>
                                        <option value="M25">M25</option>
                                        <option value="M30">M30</option>
                                        <option value="M35">M35</option>
                                        <option value="M40">M40</option>
                                    </select>
                                    <span
                                        class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500 text-xs md:text-sm">â–¾</span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

                            <div id="group-dim-1">
                                <label id="label-dim-1" class="block text-sm font-montserrat text-gray-700 mb-2">Length
                                    (mm) <span class="text-red-500">*</span></label>
                                <input type="number" step="0.01" id="input-dim-1" placeholder="0" required
                                    class="w-full border border-gray-300 rounded-lg py-2.5 px-3 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green">

                                <div id="udrain-size-wrapper" class="relative hidden">
                                    <select id="input-udrain-size"
                                        class="w-full border border-gray-300 rounded-lg py-2.5 px-3 pr-8 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green appearance-none bg-white">
                                        <option value="300x300">300 x 300 mm</option>
                                        <option value="450x450">450 x 450 mm</option>
                                        <option value="600x600">600 x 600 mm</option>
                                    </select>
                                    <span
                                        class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500 text-xs md:text-sm">â–¾</span>
                                </div>
                            </div>

                            <div id="group-dim-2">
                                <label id="label-dim-2" class="block text-sm font-montserrat text-gray-700 mb-2">Width
                                    (mm) <span class="text-red-500">*</span></label>
                                <input type="number" step="0.01" id="input-dim-2" placeholder="0" required
                                    class="w-full border border-gray-300 rounded-lg py-2.5 px-3 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green">

                                <div id="area-unit-wrapper" class="relative hidden">
                                    <select id="input-area-unit"
                                        class="w-full border border-gray-300 rounded-lg py-2.5 px-3 pr-8 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green appearance-none bg-white">
                                        <option value="sqm">Square Meters (mÂ²)</option>
                                        <option value="sqft">Square Feet (ftÂ²)</option>
                                    </select>
                                    <span
                                        class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500 text-xs md:text-sm">â–¾</span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label id="label-thickness"
                                    class="block text-sm font-montserrat text-gray-700 mb-2">Thickness (mm) <span
                                        class="text-red-500">*</span></label>
                                <div class="relative">
                                    <input type="number" id="input-thickness" placeholder="mm" required
                                        class="w-full border border-gray-300 rounded-lg py-2.5 px-3 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green">

                                    <select id="select-thickness"
                                        class="hidden w-full border border-gray-300 rounded-lg py-2.5 px-3 pr-8 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green appearance-none bg-white">
                                    </select>
                                    <span id="arrow-thickness"
                                        class="hidden pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500 text-xs md:text-sm">â–¾</span>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-montserrat text-gray-700 mb-2">Quantity (Nos) <span
                                        class="text-red-500">*</span></label>
                                <input type="number" id="input-quantity" placeholder="1" required
                                    class="w-full border border-gray-300 rounded-lg py-2.5 px-3 text-sm md:text-base font-montserrat text-gray-800 focus:outline-none focus:ring-2 focus:ring-custom-green focus:border-custom-green">
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-4 mt-4">
                            <button type="button" onclick="calculateImpact()"
                                class="flex-1 bg-custom-green text-white font-montserrat font-semibold py-2.5 rounded-lg text-sm md:text-base hover:bg-green-800 transition-colors">
                                Calculate
                            </button>
                            <button type="button" onclick="resetCalculator()"
                                class="flex-1 bg-gray-200 text-gray-800 font-montserrat font-semibold py-2.5 rounded-lg text-sm md:text-base hover:bg-gray-300 transition-colors">
                                Reset
                            </button>
                        </div>
                    </form>
                </div>

                <div class="w-full lg:w-1/2 flex flex-col">
                    <div class="grid grid-cols-1 gap-4 sm:gap-5">
                        <div class="grid grid-cols-2 gap-2 bg-card-bg-green rounded-xl py-6 px-5 text-white font-montserrat text-2xl md:text-3xl"
                            style="box-shadow: 6px 10px 3px rgba(0,0,0,0.05) inset;">
                            <span class="font-semibold text-lg md:text-xl self-center">CO2 saved</span>
                            <span class="font-semibold text-right flex justify-end items-center"><span
                                    id="res-co2">0</span>&nbsp;<span
                                    class="text-sm md:text-lg self-end mb-1">tonnes</span></span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 bg-card-bg-green rounded-xl py-6 px-5 text-white font-montserrat text-2xl md:text-3xl"
                            style="box-shadow: 6px 10px 3px rgba(0,0,0,0.05) inset;">
                            <span class="font-semibold text-lg md:text-xl self-center">Water saved</span>
                            <span class="font-semibold text-right flex justify-end items-center"><span
                                    id="res-water">0</span>&nbsp;<span
                                    class="text-sm md:text-lg self-end mb-1">litres</span></span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 bg-card-bg-dark-green rounded-xl py-6 px-5 text-white font-montserrat text-2xl md:text-3xl"
                            style="box-shadow: 6px 10px 3px rgba(0,0,0,0.05) inset;">
                            <span class="font-semibold text-lg md:text-xl self-center">Industrial waste used</span>
                            <span class="font-semibold text-right flex justify-end items-center"><span
                                    id="res-waste">0</span>&nbsp;<span
                                    class="text-sm md:text-lg self-end mb-1">tonnes</span></span>
                        </div>
                    </div>
                </div>

            </div>

            <div
                class="mt-4 bg-white/95 rounded-xl py-4 px-6 flex flex-col gap-4 text-sm md:text-base font-montserrat text-gray-800">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">ðŸŒ³</span>
                    <p class="leading-relaxed">Equivalent to planting <span id="res-trees"
                            class="font-bold text-custom-green">0</span> trees per year.</p>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-2xl">ðŸš—</span>
                    <p class="leading-relaxed">Comparable to eliminating <span id="res-cars"
                            class="font-bold text-custom-green">0</span> km of car travel.</p>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-2xl">ðŸ“±</span>
                    <p class="leading-relaxed">Equal to <span id="res-phones"
                            class="font-bold text-custom-green">0</span> smartphone charges.</p>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-2xl">ðŸ’§</span>
                    <p class="leading-relaxed">Water for <span id="res-urban"
                            class="font-bold text-custom-green">0</span> days (Urban) or <span id="res-rural"
                            class="font-bold text-custom-green">0</span> days (Rural) households.</p>
                </div>
            </div>

        </div>
    </div>
</section>

<script>
    // --- 1. CONFIGURATION DATA ---
    const UI_CONFIG = {
        "Solid Block": { type: "dims", l_label: "Length (mm)", w_label: "Width (mm)", t_label: "Height (mm)", t_options: null },
        "Paver": { type: "area", t_label: "Thickness (mm)", t_options: [60, 80, 100] },
        "Kerbstone": { type: "dims", l_label: "Length (mm)", w_label: "Width (mm)", t_label: "Thickness (mm)", t_options: null },
        "Saucer Drain": { type: "dims", l_label: "Length (mm)", w_label: "Width (mm)", t_label: "Thickness (mm)", t_options: null },
        "U Drain": { type: "udrain", t_label: "Wall Thickness (mm)", t_options: [100, 125, 150] },
        "Precast Slab": { type: "dims", l_label: "Length (mm)", w_label: "Width (mm)", t_label: "Thickness (mm)", t_options: [100, 125, 150, 200] },
        "Boundary Wall Panel": { type: "dims", l_label: "Length (mm)", w_label: "Height (mm)", t_label: "Thickness (mm)", t_options: [100, 125, 150] },
        "Precast Road": { type: "area", t_label: "Thickness (mm)", t_options: [125, 150, 175, 200, 250] },
    };

    const CEMENT_KG_PER_M3 = {
        "M7.5": 220, "M25": 320, "M30": 340, "M35": 380, "M40": 400
    };

    const DEFAULT_GRADE = {
        "Solid Block": "M7.5", "Paver": "M35", "Kerbstone": "M25",
        "Saucer Drain": "M25", "U Drain": "M30", "Precast Slab": "M30",
        "Boundary Wall Panel": "M30", "Precast Road": "M40"
    };

    // Constants
    const EF_CEMENT = 0.9;
    const REDUCTION_FACTOR = 0.75;
    const WATER_PER_M2_CURING = 70;
    const URBAN_HH_L_PER_DAY = 540;
    const RURAL_HH_L_PER_DAY = 220;
    const EF_CAR_KM = 0.18;
    const EF_TREE_PER_YEAR = 22;
    const EF_PHONE_CHARGE = 0.0082;

    // --- 2. UPDATE UI FUNCTION ---
    function updateFormFields() {
        const product = document.getElementById('calc-product').value;
        const config = UI_CONFIG[product] || UI_CONFIG["Solid Block"];

        const label1 = document.getElementById('label-dim-1');
        const input1 = document.getElementById('input-dim-1');
        const uDrainSelect = document.getElementById('udrain-size-wrapper');

        const label2 = document.getElementById('label-dim-2');
        const input2 = document.getElementById('input-dim-2');
        const unitSelect = document.getElementById('area-unit-wrapper');

        const labelThick = document.getElementById('label-thickness');
        const inputThick = document.getElementById('input-thickness');
        const selectThick = document.getElementById('select-thickness');
        const arrowThick = document.getElementById('arrow-thickness');

        // Clear errors
        document.querySelectorAll('.border-red-500').forEach(el => el.classList.remove('border-red-500'));

        // Reset visibility
        input1.classList.remove('hidden');
        uDrainSelect.classList.add('hidden');
        input2.classList.remove('hidden');
        unitSelect.classList.add('hidden');
        inputThick.classList.remove('hidden');
        selectThick.classList.add('hidden');
        arrowThick.classList.add('hidden');

        // Apply Logic
        if (config.type === 'area') {
            label1.textContent = "Area";
            label2.textContent = "Unit";
            input2.classList.add('hidden');
            unitSelect.classList.remove('hidden');
        }
        else if (config.type === 'udrain') {
            label1.textContent = "Internal Size";
            input1.classList.add('hidden');
            uDrainSelect.classList.remove('hidden');
            label2.textContent = "";
            input2.classList.add('hidden');
        }
        else {
            label1.textContent = config.l_label;
            label2.textContent = config.w_label;
        }

        labelThick.textContent = config.t_label;
        if (config.t_options) {
            inputThick.classList.add('hidden');
            selectThick.classList.remove('hidden');
            arrowThick.classList.remove('hidden');
            selectThick.innerHTML = "";
            config.t_options.forEach(opt => {
                const option = document.createElement("option");
                option.value = opt;
                option.text = opt + " mm";
                selectThick.appendChild(option);
            });
        }
    }

    // --- 3. VALIDATION ---
    function validateInputs() {
        let isValid = true;
        const requiredIds = ['input-quantity'];

        // Add visible dimensions to validation list
        if (!document.getElementById('input-dim-1').classList.contains('hidden')) requiredIds.push('input-dim-1');
        if (!document.getElementById('input-dim-2').classList.contains('hidden')) requiredIds.push('input-dim-2');
        if (!document.getElementById('input-thickness').classList.contains('hidden')) requiredIds.push('input-thickness');

        requiredIds.forEach(id => {
            const el = document.getElementById(id);
            if (!el.value || parseFloat(el.value) <= 0) {
                el.classList.add('border-red-500'); // Add red border
                isValid = false;
            } else {
                el.classList.remove('border-red-500');
            }
        });

        if (!isValid) {
            alert("Please fill in all mandatory fields with valid numbers.");
        }
        return isValid;
    }

    // --- 4. CALCULATION LOGIC ---
    function calculateImpact() {
        if (!validateInputs()) return;

        const product = document.getElementById('calc-product').value;
        const gradeInput = document.getElementById('calc-grade').value;
        const quantity = parseFloat(document.getElementById('input-quantity').value) || 0;

        let grade = gradeInput;
        if (grade === "Default" || !grade) {
            grade = DEFAULT_GRADE[product] || "M30";
        }

        let total_volume_m3 = 0.0;
        let total_curing_area_m2 = 0.0;

        // DIVIDE INPUTS BY 1000 TO CONVERT MM TO M
        if (product === "Solid Block") {
            const L = (parseFloat(document.getElementById('input-dim-1').value) || 0) / 1000.0;
            const B = (parseFloat(document.getElementById('input-dim-2').value) || 0) / 1000.0;
            const H = (parseFloat(document.getElementById('input-thickness').value) || 0) / 1000.0;

            total_volume_m3 = (L * B * H) * quantity;
            total_curing_area_m2 = (L * B) * quantity;
        }
        else if (product === "Paver" || product === "Precast Road") {
            const areaVal = parseFloat(document.getElementById('input-dim-1').value) || 0;
            const unit = document.getElementById('input-area-unit').value;
            const thickness_mm = parseFloat(document.getElementById('select-thickness').value) || 0;

            let area_m2 = (unit === "sqft") ? areaVal * 0.092903 : areaVal;
            let thickness_m = thickness_mm / 1000.0;

            total_volume_m3 = area_m2 * thickness_m;
            total_curing_area_m2 = area_m2;
        }
        else if (product === "Kerbstone" || product === "Saucer Drain") {
            const L = (parseFloat(document.getElementById('input-dim-1').value) || 0) / 1000.0;
            const B = (parseFloat(document.getElementById('input-dim-2').value) || 0) / 1000.0;
            const H = (parseFloat(document.getElementById('input-thickness').value) || 0) / 1000.0;

            total_volume_m3 = (L * B * H) * quantity;
            total_curing_area_m2 = (L * H) * quantity;
        }
        else if (product === "U Drain") {
            const sizeStr = document.getElementById('input-udrain-size').value;
            const parts = sizeStr.split('x');
            const inner_w_mm = parseFloat(parts[0]);
            const inner_h_mm = parseFloat(parts[1]);
            const wall_mm = parseFloat(document.getElementById('select-thickness').value) || 0;

            const L_drain = 2.0;
            const inner_w_m = inner_w_mm / 1000.0;
            const inner_h_m = inner_h_mm / 1000.0;
            const t_m = wall_mm / 1000.0;

            const outer_w_m = inner_w_m + (2 * t_m);
            const outer_h_m = inner_h_m + t_m;

            const outer_area = outer_w_m * outer_h_m;
            const inner_area = inner_w_m * inner_h_m;
            const section_area = outer_area - inner_area;

            total_volume_m3 = (section_area * L_drain) * quantity;
            total_curing_area_m2 = (inner_w_m * L_drain) * quantity;
        }
        else if (product === "Precast Slab" || product === "Boundary Wall Panel") {
            const L = (parseFloat(document.getElementById('input-dim-1').value) || 0) / 1000.0;
            const B = (parseFloat(document.getElementById('input-dim-2').value) || 0) / 1000.0;
            const thick_mm = parseFloat(document.getElementById('select-thickness').value) || 0;
            const thick_m = thick_mm / 1000.0;

            total_volume_m3 = (L * B * thick_m) * quantity;
            total_curing_area_m2 = (L * B) * quantity;
        }

        // --- MATHS ---
        const cement_per_m3 = CEMENT_KG_PER_M3[grade] || 340;
        const cement_mass_kg = total_volume_m3 * cement_per_m3;
        const conventional_co2_kg = cement_mass_kg * EF_CEMENT;
        const co2_saved_kg = conventional_co2_kg * REDUCTION_FACTOR;
        const co2_saved_tonnes = co2_saved_kg / 1000.0;

        const water_saved_liters = total_curing_area_m2 * WATER_PER_M2_CURING;
        const urban_days = water_saved_liters / URBAN_HH_L_PER_DAY;
        const rural_days = water_saved_liters / RURAL_HH_L_PER_DAY;

        const car_km = co2_saved_kg / EF_CAR_KM;
        const trees = co2_saved_kg / EF_TREE_PER_YEAR;
        const phones = co2_saved_kg / EF_PHONE_CHARGE;
        const waste_tonnes = (cement_mass_kg * REDUCTION_FACTOR) / 1000.0;

        // --- UPDATE UI WITH SMART ROUNDING ---
        // If value is small but positive, show 4 decimals. Otherwise show 2.

        // Helper to format text
        const fmt = (val) => {
            let decimals = val > 0 && val < 0.01 ? 4 : 2;
            return val.toLocaleString('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        };
        document.getElementById('res-co2').innerText = fmt(co2_saved_tonnes);
        document.getElementById('res-waste').innerText = fmt(waste_tonnes);

        // Water, Trees, Cars, and Phones (Whole numbers with commas)
        document.getElementById('res-water').innerText = Math.round(water_saved_liters).toLocaleString('en-US');
        document.getElementById('res-trees').innerText = Math.round(trees).toLocaleString('en-US');
        document.getElementById('res-cars').innerText = Math.round(car_km).toLocaleString('en-US');
        document.getElementById('res-phones').innerText = Math.round(phones).toLocaleString('en-US');

        // Days (1 decimal place with commas)
        document.getElementById('res-urban').innerText = urban_days.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
        document.getElementById('res-rural').innerText = rural_days.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
    }

    function resetCalculator() {
        document.getElementById('impact-calculator-form').reset();
        document.querySelectorAll('.border-red-500').forEach(el => el.classList.remove('border-red-500'));
        updateFormFields();
        document.getElementById('res-co2').innerText = "0";
        document.getElementById('res-water').innerText = "0";
        document.getElementById('res-waste').innerText = "0";
        document.getElementById('res-trees').innerText = "0";
        document.getElementById('res-cars').innerText = "0";
        document.getElementById('res-phones').innerText = "0";
        document.getElementById('res-urban').innerText = "0";
        document.getElementById('res-rural').innerText = "0";
    }

    document.addEventListener('DOMContentLoaded', updateFormFields);
</script>

{% endblock %}